## 웹 서버의 다중화

### DNS 라운드 로빈
- DNS 라운드로빈이란 DNS를 이용해 하나의 서비스에 여러대의 서버를 분산시키는 방법
- 유저 A, B가 www.example.jp 에 접속하고자 한다 가정한다면, 각각 두사람은 DNS 서버에 www.example.jp의 IP주소를 질의하게 됨
- 그러면 DNS 서버는 x.x.x.1, x.x.x.2라는 서로 다른 IP주소를 반환함
- 그 결과 A는 x.x.x.x1로, B는 x.x.x.x2로 접속하게 됨

- DNS 서버는 동일한 이름으로 여러 레코드를 등록시키면 질의할때마다 다른 결과를 반환함
- 이 동작을 이용함으로서 여러 대의 서버에 처리를 분산시킬 수가 있음
- 비교적 간단히 부하분산할 수 있는 DNS 라운드 로빈이지만 다음과 같은 문제가 있음
- DNS 서버는 동일 이름으로 여러 레코드를 등록시키면 질의할때마다 다른 결과를 반환
- 이 동작을 이용해 여러 대의 서버에 처리를 분산 시킬 수 있음
- 이는 비교적 간단히 부하분산할 수 있는 DNS 라운드 로빈이지만 다음과 같은 문제가 있음
  - 서버의 수만큼 글로벌 주소가 필요
  - 균등하게 분산되는 것은 아님
    - 모바일 사이트 등에서 문제가 되는 경우가 있음
    - 휴대전화로부터 접속은 캐리어 게이트웨이라 하는 프록시 서버를 경유
    - 프록시 서버에서는 이름변환 결과가 일정시간 캐싱
    - 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 전달
    - 따라서 균등하게 접속이 분산되지 않고 특정 서버에만 처리 집중 가능성 있음
    - PC용 웹브라우저도 DNS 질의 결과를 캐싱하기 때문에 균등하게 부하분산되지는 않음
    - DNS 레코드의 TTL(Time To Live)를 짧게 설정함으로써 어느정도 개선 가능하나, 반드시 TTL에 따라 캐시를 해제하는 것은 아니므로 주의 필요
  - 서버가 다운돼도 감지못함
    - DNS 서버는 웹 서버의 부하나 접속수 등의 상황에 따라 질의결과를 제어 할 수 없음
    - 현재 서버의 부하가 높아서 응답이 느려지거나 접속수가 꽉 차서 접속을 처리하지 못하는지 감지하지 못함
    - 이에 따라 서버가 다운되더라도 계속 부하분산을 함
    - 이로 인해 다운된 서버로 분산된 유저는 에러 페이지를 접하게 됨
    - DNS 라운드 로빈은 부하분산하기 위한 방법이고 다중화 방법은 아니므로 다른 소프트웨어와 조합해 헬스체크나 장애극복을 마련할 필요 있음


